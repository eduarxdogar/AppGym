<!-- Fondo moderno y oscuro -->
<div
  class="min-h-screen bg-[url('https://images.unsplash.com/photo-1605296867304-46d5465a13f1?auto=format&fit=crop&w=1950&q=80')] bg-cover bg-center bg-no-repeat backdrop-blur-xl bg-blend-multiply p-4 sm:p-8"
>
  <div class="max-w-5xl mx-auto animate-fadeIn">
    <!-- Título -->
    <h2 class="text-3xl font-bold mb-6 flex items-center gap-3 text-green-400">
      <mat-icon class="text-green-400">fitness_center</mat-icon> Mis Rutinas
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
      <!-- Sección AI Coach / Mapa de Fatiga -->
      <div class="md:col-span-1">
        <app-recovery-monitor></app-recovery-monitor>
      </div>

      <!-- Call to Action AI -->
      <div
        class="md:col-span-2 bg-gradient-to-br from-zinc-900 to-black border border-zinc-800 rounded-xl p-6 flex flex-col justify-center items-start shadow-xl relative overflow-hidden"
      >
        <!-- Deco BG -->
        <div
          class="absolute right-0 top-0 bottom-0 w-1/3 bg-primary/5 skew-x-12 transform translate-x-10 pointer-events-none"
        ></div>

        <h3 class="text-2xl font-extrabold text-white mb-2 relative z-10">
          GRAVL <span class="text-primary">AI Coach</span>
        </h3>
        <p class="text-zinc-400 mb-6 max-w-md relative z-10">
          Tu entrenador personal basado en inteligencia artificial. Analizamos
          tu fatiga muscular actual para generar la rutina perfecta para hoy.
        </p>

        <app-ui-button
          (clicked)="generateAiRoutine()"
          variant="primary"
          customClass="shadow-[0_0_20px_rgba(204,252,126,0.4)] animate-pulse hover:animate-none"
          [disabled]="isGenerating"
        >
          <mat-icon class="mr-2">{{
            isGenerating ? "hourglass_empty" : "auto_awesome"
          }}</mat-icon>
          {{
            isGenerating ? "Diseñando Rutina..." : "Generar Rutina Inteligente"
          }}
        </app-ui-button>
      </div>
    </div>

    <!-- Lista de rutinas -->
    <div *ngIf="workouts().length > 0; else noWorkouts" class="grid gap-6">
      <app-ui-card
        *ngFor="let workout of workouts()"
        [title]="workout.nombre"
        [description]="'Ejercicios: ' + workout.ejercicios.length"
        customClass="bg-white/5 backdrop-blur-sm border-none shadow-md hover:shadow-xl transition duration-300"
        [hasFooter]="true"
      >
        <!-- Body Content (Description or details could go here) -->
        <div class="text-gray-300">
          <!-- Placeholder for more details if needed -->
          <p>Nivel: {{ workout.nivelDificultad }}</p>
        </div>

        <!-- Footer Actions -->
        <div footer class="flex flex-wrap gap-3 justify-end">
          <app-ui-button
            variant="primary"
            customClass="flex items-center gap-1 bg-blue-600 hover:bg-blue-700"
            (clicked)="editWorkout(workout.id)"
          >
            <!-- Reusing editWorkout as navigation wrapper? Or separate -->
            <!-- The original used routerLink directly. app-button emits click. 
                  I need to handle navigation in component or pass routerLink if supported. 
                  My app-button doesn't support routerLink. 
                  I will use (clicked) and methods in TS or keep <a> for links and style them like buttons?
                  The user wants reusable components. 
                  I will wrap the <a> with the button style classes from the shared component or use the click handler.
                  Ideally a ButtonComponent should support "as link". 
                  For now I'll use the click handler integration. 
             -->
            <mat-icon>visibility</mat-icon> Ver
          </app-ui-button>

          <app-ui-button
            variant="secondary"
            customClass="flex items-center gap-1 bg-yellow-500 hover:bg-yellow-600"
            (clicked)="router.navigate(['/workout', workout.id, 'edit'])"
          >
            <mat-icon>edit</mat-icon> Editar
          </app-ui-button>

          <app-ui-button
            variant="danger"
            customClass="flex items-center gap-1 bg-red-600 hover:bg-red-700"
            (clicked)="deleteWorkout(workout.id)"
          >
            <mat-icon>delete</mat-icon> Eliminar
          </app-ui-button>
        </div>
      </app-ui-card>
    </div>

    <!-- Si no hay rutinas -->
    <ng-template #noWorkouts>
      <div class="text-center mt-10">
        <app-ui-card customClass="bg-white/5 backdrop-blur-sm">
          <p
            class="text-gray-400 text-lg flex items-center justify-center gap-2"
          >
            <mat-icon class="text-yellow-400">info</mat-icon>
            No tienes rutinas aún.
          </p>
        </app-ui-card>
      </div>
    </ng-template>

    <!-- Botón agregar rutina -->
    <div class="mt-10 text-center">
      <app-ui-button
        variant="primary"
        customClass="bg-green-600 hover:bg-green-700 rounded-full px-6 py-3 text-lg"
        (clicked)="addWorkout()"
      >
        <mat-icon>add_circle</mat-icon> Nueva Rutina
      </app-ui-button>
    </div>
  </div>
</div>
