<!-- Contenedor principal con fondo, imagen, blur, etc. -->
<div
  class="min-h-screen bg-[url('https://images.unsplash.com/photo-1605296867304-46d5465a13f1?auto=format&fit=crop&w=1950&q=80')] bg-cover bg-center bg-no-repeat backdrop-blur-xl bg-blend-multiply p-4 sm:p-8 relative">
  <!-- Overlay -->
  <div class="absolute inset-0 bg-black/40 rounded-lg z-0"></div>

  <!-- Contenido principal -->
  <div class="relative z-10 space-y-6 text-yellow-500">
    <h2 class="text-4xl font-extrabold text-center drop-shadow-lg">
      üèãÔ∏è‚Äç‚ôÇÔ∏è {{ workout.nombre }}
    </h2>
    <hr class="border-t border-gray-400/40" />

    <!-- Lista de ejercicios en un acorde√≥n -->
    <ul class="space-y-4">
      <li *ngFor="let ejercicio of workout.ejercicios; let i = index"
        class="bg-gray-800/80 hover:bg-gray-700 transition rounded-xl p-4 shadow-lg backdrop-blur-sm border border-gray-700 animate-fadeIn"
        [ngClass]="getDelayClass(i)">
        <!-- Cabecera del acorde√≥n -->
        <div class="flex justify-between items-center cursor-pointer select-none" (click)="toggleExpand(i)">
          <div class="flex items-center gap-3">
            <mat-icon class="text-black text-3xl">fitness_center</mat-icon>
            <p class="font-semibold text-xl text-white tracking-wide">{{ ejercicio.nombre }}</p>
            <a href="http://"></a>
          </div>
          <mat-icon class="text-white transform transition-transform duration-300"
            [ngClass]="{'rotate-180': expandedIndex === i, 'rotate-0': expandedIndex !== i}">
            expand_more
          </mat-icon>
        </div>
        <!-- Detalles del ejercicio (visible al expandir) -->
        <div *ngIf="expandedIndex === i"
          class="transition-all duration-500 ease-in-out overflow-hidden mt-4 pl-12 text-gray-300 space-y-3 ">
          <!-- Fila de detalles con iconos Material y mejor disposici√≥n -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 pr-4">


            <div class="flex items-center gap-3 w-full">
              <mat-icon class="text-indigo-400 flex-shrink-0">local_fire_department</mat-icon>
              <div>
                <span class="font-medium text-indigo-400">Calentamiento:</span>
                {{ ejercicio.serieCalentamiento }} series, {{ ejercicio.repeticionesCalentamiento }} reps
              </div>
            </div>

            <div class="flex items-center gap-3">
              <mat-icon class="text-green-400 drop-shadow-sm material-icons-round">speed</mat-icon>
              <div>
                <span class="font-medium text-green-400">Series:</span>
                {{ ejercicio.series }}
              </div>
            </div>

            <div class="flex items-center gap-3">
              <mat-icon class="text-yellow-400 drop-shadow-sm">repeat</mat-icon>
              <div>
                <span class="font-medium text-yellow-400">Reps:</span>
                {{ ejercicio.repeticiones }}
              </div>
            </div>

            <div class="flex items-center gap-3">
              <mat-icon class="text-red-300 drop-shadow-sm">fitness_center</mat-icon>
              <div>
                <span class="font-medium text-red-300">M√∫sculo:</span>
                {{ ejercicio.grupoMuscular }}
              </div>
            </div>

            <div class="flex items-center gap-3">
              <mat-icon class="text-indigo-300 drop-shadow-sm">timer</mat-icon>
              <div>
                <span class="font-medium text-indigo-300">Descanso:</span>
                {{ ejercicio.descanso }}
              </div>
            </div>

            <div class="flex items-center gap-3">
              <mat-icon class="text-orange-300 drop-shadow-sm">balance</mat-icon>
              <div>
                <span class="font-medium text-orange-300">Peso:</span>
                {{ ejercicio.pesokg }} kg
              </div>
            </div>

            <div class="flex items-center gap-3 drop-shadow-sm">
              <mat-icon class="text-purple-400">tune</mat-icon>
              <div>
                <span class="font-medium text-purple-400">Tipo:</span>
                {{ ejercicio.tipo }}
              </div>
            </div>
          </div>
          <!-- Mostrar el drop set si existe -->
          <!-- Dentro de la tarjeta de cada ejercicio, despu√©s de mostrar los datos b√°sicos -->
          <div *ngIf="ejercicio.superSetEjercicio" class="relative mt-3 p-3 bg-gray-600 rounded">
            <!-- Bot√≥n (peque√±o) para eliminar la super serie, posicionado en la esquina -->
            <button (click)="removerSuperSet(i)"
              class="absolute top-1 right-1 text-white hover:text-red-500 focus:outline-none"
              title="Eliminar Super Serie">
              <mat-icon>close</mat-icon>
            </button>

            <h4 class="font-semibold text-yellow-400">Super Serie:</h4>
            <div>
              <strong>Nombre:</strong> {{ ejercicio.superSetEjercicio.nombre }}
            </div>
            <div>
              <strong class="text-red-300 font-bold">Grupo muscular:</strong> {{
              ejercicio.superSetEjercicio.grupoMuscular }}
            </div>
            <div>
              <strong class="text-purple-400 font-bold">Tipo:</strong> {{ ejercicio.superSetEjercicio.tipo }}
            </div>
            <div>
              <strong class="text-green-400 font-bold">Series:</strong> {{ ejercicio.superSetEjercicio.series }},
              <strong class="text-yellow-400 font-bold">Reps:</strong> {{ ejercicio.superSetEjercicio.repeticiones }},
              <strong class="text-purple-400 font-bold">Descanso:</strong> {{ ejercicio.superSetEjercicio.descanso }}
            </div>
            <!-- Bot√≥n para editar la super serie (opcional) -->
            <button (click)="editarSuperSet(i)" class="mt-2 text-white bg-blue-500 px-2 py-1 rounded">
              Editar Super Serie
            </button>
          </div>

          <div *ngIf="ejercicio.dropSet" class="mt-3 p-3 relative bg-gray-700 rounded">
            <button (click)="removerDropSet(i)"
              class="absolute top-1 right-1 text-white hover:text-red-500 focus:outline-none" title="Eliminar Drop Set">
              <mat-icon>close</mat-icon>
            </button>
            <h4 class="font-semibold text-yellow-400">Drop Set:</h4>
            <ul class="ml-4 mt-2">
              <li *ngFor="let ds of ejercicio.dropSet.sets; let idx = index">

                <!-- Ejemplo de mostrar repeticiones y c√°lculo de peso basado en porcentaje -->
                <span class="text-green-400  font-bold">

                  Set {{ idx + 1 }}:
                  {{ ds.repeticiones }} reps
                  a {{ (ejercicio.pesokg! * ds.porcentaje) | number:'1.0-0' }} kg
                  ({{ ds.porcentaje * 100 | number:'1.0-0' }}%)
                </span>
              </li>
            </ul>
          </div>
          <!-- Botones de edici√≥n y eliminaci√≥n para cada ejercicio -->
          <div class="flex flex-wrap gap-2 mt-2 sm:gap-4">
            <app-button (clicked)="editExercise(i)" variant="primary"
              customClass="bg-blue-600 hover:bg-blue-700 flex-1 min-w-[140px] flex items-center justify-center gap-1">
              <mat-icon>edit</mat-icon> Editar
            </app-button>
            <app-button (clicked)="deleteExercise(i)" variant="danger"
              customClass="bg-red-600 hover:bg-red-700 flex-1 min-w-[140px] flex items-center justify-center gap-1">
              <mat-icon>delete</mat-icon> Eliminar
            </app-button>
            <!-- Botones adicionales -->
            <button (click)="addSuperSet(i)"
              class="bg-purple-600 flex-1 min-w-[140px] hover:bg-purple-700 text-white px-3 py-1 rounded">
              <mat-icon>link</mat-icon> Super Set
            </button>
            <button (click)="addDropsetAvanzado(i)"
              class="bg-yellow-600 flex-1 min-w-[140px] hover:bg-cyan-700 text-white px-3 py-1 rounded">
              <mat-icon>bolt</mat-icon> Drop Set
            </button>
          </div>
        </div>
      </li>
    </ul>

    <hr class="border-t border-gray-400/40" />

    <!-- Formulario para agregar/editar ejercicio -->
    <div class="mb-10">
      <h3 class="text-2xl font-semibold mb-4 text-green-500 flex items-center gap-2">
        <mat-icon class="text-green-400">add_circle</mat-icon>
        {{ editingExerciseIndex !== null ? "Editar Ejercicio" : "Agregar Ejercicio" }}
      </h3>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Nombre del ejercicio -->
        <div>
          <app-input label="Nombre" id="exercise-name" [(ngModel)]="newExercise.nombre" placeholder="Ej: Press banca"
            containerClass="mb-0"></app-input>
        </div>
        <!-- Series de calentamiento -->
        <div>
          <app-input label="Series Calentamiento" id="exercise-seriescal" type="number"
            [(ngModel)]="newExercise.serieCalentamiento" containerClass="mb-0"></app-input>
        </div>
        <!-- Series -->
        <div>
          <app-input label="Series" id="exercise-series" type="number" [(ngModel)]="newExercise.series"
            containerClass="mb-0"></app-input>
        </div>
        <!-- Repeticiones de calentamiento -->
        <div>
          <app-input label="Reps Calentamiento" id="exercise-repscal" type="number"
            [(ngModel)]="newExercise.repeticionesCalentamiento" containerClass="mb-0"></app-input>
        </div>
        <!-- Repeticiones -->
        <div>
          <app-input label="Repeticiones" id="exercise-reps" type="number" [(ngModel)]="newExercise.repeticiones"
            containerClass="mb-0"></app-input>
        </div>
        <!-- Peso -->
        <div>
          <app-input label="Peso (Kg)" id="exercise-pesokg" type="number" [(ngModel)]="newExercise.pesokg"
            containerClass="mb-0"></app-input>
        </div>
        <!-- Grupo muscular -->
        <div>
          <label for="exercise-grupo" class="mb-2 text-sm font-medium text-yellow-500 flex items-center gap-2">
            <mat-icon class="text-pink-500">groups</mat-icon> Grupo Muscular
          </label>
          <select id="exercise-grupo" [(ngModel)]="newExercise.grupoMuscular"
            (change)="actualizarNombreRutinaPorGrupo(newExercise.grupoMuscular)"
            class="w-full p-3 rounded border border-gray-300 text-gray-800 focus:outline-none focus:ring-2 focus:ring-pink-400">
            <option *ngFor="let grupo of grupoMuscularOpciones" [value]="grupo">
              {{ grupo | titlecase }}
            </option>
          </select>
        </div>
        <!-- Tipo de ejercicio -->
        <div>
          <label for="exercise-tipo" class="mb-2 text-sm font-medium text-yellow-500 flex items-center gap-2">
            <mat-icon class="text-indigo-500">category</mat-icon> Tipo de Ejercicio
          </label>
          <select id="exercise-tipo" [(ngModel)]="newExercise.tipo"
            class="w-full p-3 rounded border border-gray-300 text-gray-800 focus:outline-none focus:ring-2 focus:ring-indigo-400">
            <option *ngFor="let tipo of tiposEjercicio" [value]="tipo">{{ tipo | titlecase }}</option>
          </select>
        </div>
        <!-- Selector de nivel de dificultad -->
        <div>
          <label for="nivelDificultad" class="mb-2 text-sm font-medium text-yellow-500 flex items-center gap-2">
            <mat-icon class="text-indigo-500">category</mat-icon> Nivel de Dificultad:
          </label>
          <select id="nivelDificultad" [(ngModel)]="workout.nivelDificultad"
            class="w-full p-3 rounded border border-gray-300 text-gray-800 focus:outline-none focus:ring-2 focus:ring-indigo-400">
            <option *ngFor="let nivel of nivelesDisponibles" [value]="nivel">{{ nivel | titlecase }}</option>
          </select>
        </div>
      </div>

      <div class="flex gap-3">
        <app-ui-button (clicked)="cancel()" variant="ghost" customClass="text-zinc-400 hover:text-white">
          Cancelar
        </app-ui-button>
        <app-ui-button (clicked)="saveChanges()" variant="primary"
          customClass="px-8 shadow-[0_0_20px_rgba(204,252,126,0.3)]">
          Guardar Cambios
        </app-ui-button>
      </div>
    </div>

    <!-- Main Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

      <!-- Left Column: Settings -->
      <div class="space-y-6">
        <app-ui-card title="Configuraci√≥n General"
          customClass="bg-secondary/50 border-zinc-800 backdrop-blur-sm h-full">
          <div class="grid grid-cols-1 gap-6">
            <app-ui-input label="Nombre de la Rutina" [(ngModel)]="workout.nombre" placeholder="Ej: Push Day A"
              containerClass="border-zinc-800 focus-within:border-primary/50 bg-black/50">
            </app-ui-input>

            <div class="flex flex-col gap-2">
              <label class="text-sm font-medium text-zinc-300">Dificultad</label>
              <select [(ngModel)]="workout.nivelDificultad" (change)="actualizarConfiguracionPorNivel()"
                class="bg-black/50 border border-zinc-800 text-white rounded-md p-2 focus:border-primary/50 outline-none transition-colors">
                <option *ngFor="let nivel of nivelesDisponibles" [value]="nivel">{{ nivel | titlecase }}</option>
              </select>
            </div>
          </div>
        </app-ui-card>
      </div>

      <!-- Right Column: Exercises Editor -->
      <div class="lg:col-span-2 space-y-6">

        <!-- Add Exercise Form -->
        <app-ui-card customClass="bg-zinc-900/30 border-zinc-800 border-dashed">
          <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
            <mat-icon class="text-primary">add_circle_outline</mat-icon>
            {{ editingExerciseIndex !== null ? 'Editar Ejercicio' : 'Agregar Ejercicio' }}
          </h3>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <app-ui-input label="Nombre" [(ngModel)]="newExercise.nombre" placeholder="Ej: Press Banca"
              containerClass="bg-black/50 border-zinc-800">
            </app-ui-input>

            <div class="flex flex-col gap-1">
              <label class="text-xs text-zinc-400 ml-1">Grupo Muscular</label>
              <select [(ngModel)]="newExercise.grupoMuscular"
                class="bg-black/50 border border-zinc-800 text-white rounded-md h-9 px-3 text-sm focus:border-primary/50 outline-none w-full">
                <option *ngFor="let grupo of grupoMuscularOpciones" [value]="grupo">{{ grupo | titlecase }}</option>
              </select>
            </div>

            <div class="flex gap-4">
              <app-ui-input label="Series" type="number" [(ngModel)]="newExercise.series"
                containerClass="bg-black/50 border-zinc-800">
              </app-ui-input>
              <app-ui-input label="Reps" type="number" [(ngModel)]="newExercise.repeticiones"
                containerClass="bg-black/50 border-zinc-800">
              </app-ui-input>
            </div>

            <div class="flex gap-4">
              <app-ui-input label="Peso (kg)" type="number" [(ngModel)]="newExercise.pesokg"
                containerClass="bg-black/50 border-zinc-800">
              </app-ui-input>
              <!-- Descanso as simple input for now, ideally a selector or formatted input -->
              <app-ui-input label="Descanso" [(ngModel)]="newExercise.descanso" placeholder="Ej: 90s"
                containerClass="bg-black/50 border-zinc-800">
              </app-ui-input>
            </div>
          </div>

          <div class="flex justify-end gap-3 transition-all">
            <app-ui-button *ngIf="editingExerciseIndex !== null" (clicked)="cancelEdit()" variant="ghost">
              Cancelar Edici√≥n
            </app-ui-button>

            <app-ui-button (clicked)="addExercise()" variant="secondary" [disabled]="!newExercise.nombre"
              customClass="hover:bg-primary hover:text-black transition-colors">
              {{ editingExerciseIndex !== null ? 'Actualizar' : 'Agregar a la Lista' }}
            </app-ui-button>
          </div>
        </app-ui-card>

        <!-- Exercises List -->
        <div class="space-y-3">
          <div *ngFor="let ejercicio of workout.ejercicios; let i = index"
            class="group relative overflow-hidden rounded-xl bg-secondary/40 border border-zinc-800 p-4 transition-all hover:border-primary/30 hover:bg-secondary/60">

            <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
              <div class="flex items-center gap-4 flex-1">
                <span
                  class="text-2xl font-bold text-zinc-700 group-hover:text-primary/50 pointer-events-none select-none">
                  {{ i + 1 < 10 ? '0' +(i+1) : i+1 }} </span>
                    <div>
                      <h4 class="font-bold text-white text-lg">{{ ejercicio.nombre }}</h4>
                      <p class="text-xs text-zinc-400">
                        {{ ejercicio.grupoMuscular | titlecase }} ‚Ä¢ {{ ejercicio.series }} x {{ ejercicio.repeticiones
                        }} ‚Ä¢ {{ ejercicio.pesokg }}kg
                      </p>
                    </div>
              </div>

              <!-- Actions -->
              <div class="flex gap-2">
                <app-ui-button (clicked)="editExercise(i)" variant="ghost" size="sm"
                  customClass="h-8 w-8 p-0 text-zinc-400 hover:text-white">
                  <mat-icon class="text-sm">edit</mat-icon>
                </app-ui-button>

                <app-ui-button (clicked)="deleteExercise(i)" variant="ghost" size="sm"
                  customClass="h-8 w-8 p-0 text-zinc-400 hover:text-destructive">
                  <mat-icon class="text-sm">delete</mat-icon>
                </app-ui-button>

                <button [matMenuTriggerFor]="menu"
                  class="ml-2 h-8 w-8 flex items-center justify-center rounded-md hover:bg-white/5 text-zinc-500 hover:text-white transition-colors">
                  <mat-icon>more_vert</mat-icon>
                </button>
                <mat-menu #menu="matMenu" class="custom-menu">
                  <button mat-menu-item (click)="addSuperSet(i)">
                    <mat-icon>link</mat-icon> Crear Super Set
                  </button>
                  <button mat-menu-item (click)="addDropsetAvanzado(i)">
                    <mat-icon>trending_down</mat-icon> Crear Drop Set
                  </button>
                </mat-menu>
              </div>
            </div>

            <!-- SuperSet / DropSet Logic Visuals -->
            <!-- (Keeping simple for now, can expand based on existing logic if needed) -->

          </div>

          <div *ngIf="workout.ejercicios.length === 0"
            class="text-center py-12 border border-dashed border-zinc-800 rounded-xl bg-black/20">
            <p class="text-zinc-500">No hay ejercicios en esta rutina a√∫n.</p>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>